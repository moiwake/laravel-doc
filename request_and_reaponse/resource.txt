https://readouble.com/laravel/9.x/ja/eloquent-resources.html



ðŸŸ¡APIãƒªã‚½ãƒ¼ã‚¹
ãƒ¢ãƒ‡ãƒ«ãªã©ã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’JSONå½¢å¼ã«å¤‰æ›ã—ã€APIã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚
APIã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”¨ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ•´å½¢ã—ã¦ã‚«ã‚¹ã‚¿ãƒžã‚¤ã‚ºã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚



ðŸ”µResourceã‚¯ãƒ©ã‚¹ã®ä½œæˆ
â€»Illuminate\Http\Resources\Json\JsonResourceã‚¯ãƒ©ã‚¹ã‚’æ‹¡å¼µã™ã‚‹

ã‚¬ã‚¤ãƒ‰ã€Œãƒªã‚½ãƒ¼ã‚¹ã®ç”Ÿæˆã€



ðŸ”µResourceã‚¯ãƒ©ã‚¹ã®å®šç¾©

ðŸŸ¢toArrayãƒ¡ã‚½ãƒƒãƒ‰
JSONã¸å¤‰æ›ã™ã‚‹ãŸã‚ã€toArrayãƒ¡ã‚½ãƒƒãƒ‰ã‚’å¿…ãšå®šç¾©ã™ã‚‹ã€‚

ä¾‹ï¼‰
public function toArray($request)
{
    return [
        'id' => $this->id,
        'name' => $this->name,
        'created_at' => $this->created_at,
        'updated_at' => $this->updated_at,
    ];
}

â‡’JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
    "id": 1,
    "name": "Example Name",
    "created_at": "2022-02-04T12:34:56.000000Z",
    "updated_at": "2022-02-04T18:45:12.000000Z"
}

ðŸŸ¢Resourceã‚¯ãƒ©ã‚¹ã®$this
Resourceã‚¯ãƒ©ã‚¹ã®$thisã¯ã€ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«æ¸¡ã—ãŸãƒ¢ãƒ‡ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ãŒå…¥ã£ã¦ã„ã‚‹ã€‚ã€‚ã€‚ï¼Ÿï¼Ÿï¼Ÿ
â‡’$thisã‹ã‚‰ãƒ¢ãƒ‡ãƒ«ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å‚ç…§ã§ãã‚‹ï¼ˆä¾‹ï¼š$this->idï¼‰



ðŸŸ¡ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹

ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚„ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã®JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’æ•´å½¢ã™ã‚‹æ–¹æ³•

â‘ Resourceã‚¯ãƒ©ã‚¹ã®collectionãƒ¡ã‚½ãƒƒãƒ‰
â‘¡Collectionã‚¯ãƒ©ã‚¹

Resourceã‚¯ãƒ©ã‚¹ã®collection
ãƒ¼ã€€ãƒ¡ãƒªãƒƒãƒˆ
ãƒ»ç°¡æ½”ã§ã‚ã‹ã‚Šã‚„ã™ã„
ãƒ»ä¸€ã¤ã®ã‚¯ãƒ©ã‚¹ã§ç‹¬ç«‹ã—ã¦ã„ã¦ã€çµåˆæ€§ãŒä½Žã„

ãƒ¼ã€€ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã¨ã¨ã‚‚ã«è¿”ã™å¿…è¦ã®ã‚ã‚‹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆè¿½åŠ ã‚„è£œè¶³ã®æƒ…å ±ï¼‰ãŒã‚ã£ã¦ã‚‚è¿½åŠ ã§ããªã„ã€‚
â‡’Collectionã‚¯ãƒ©ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ã€‚

â€»Resourceã‚¯ãƒ©ã‚¹ã§ã‚‚ã€additional()ã‚’ä½¿ç”¨ã™ã‚Œã°ã€å‘¼ã³å‡ºã—å´ã§ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã§ãã‚‹ã€‚



ðŸ”µcollectionãƒ¡ã‚½ãƒƒãƒ‰
Resourceã‚¯ãƒ©ã‚¹ã®collectionãƒ¡ã‚½ãƒƒãƒ‰

ä¾‹ï¼‰UserResource::collection(User::all())

ãƒ¼ã€€ãƒ¡ãƒªãƒƒãƒˆ
ãƒ»ç°¡æ½”ã§ã‚ã‹ã‚Šã‚„ã™ã„
ãƒ»ä¸€ã¤ã®ã‚¯ãƒ©ã‚¹ã§ç‹¬ç«‹ã—ã¦ã„ã¦ã€çµåˆæ€§ãŒä½Žã„

ãƒ¼ã€€ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã¨ã¨ã‚‚ã«è¿”ã™å¿…è¦ã®ã‚ã‚‹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆè¿½åŠ ã‚„è£œè¶³ã®æƒ…å ±ï¼‰ãŒã‚ã£ã¦ã‚‚è¿½åŠ ã§ããªã„ã€‚
â‡’Collectionã‚¯ãƒ©ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ã€‚



ðŸ”µCollectionã‚¯ãƒ©ã‚¹
ãƒªã‚½ãƒ¼ã‚¹ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚¯ãƒ©ã‚¹
Illuminate\Http\Resources\Json\ResourceCollectionã‚’æ‹¡å¼µã™ã‚‹ã€‚

ä¾‹ï¼‰new UserCollection(User::all())

ðŸŸ¢ä»•çµ„ã¿
Collectionã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆã™ã‚‹ã¨ã€
å¯¾å¿œã™ã‚‹Resourceã‚¯ãƒ©ã‚¹ã®toArrayãƒ¡ã‚½ãƒƒãƒ‰ã§å®šç¾©ã—ãŸæ§‹é€ ã‚’æŒã¤ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã¨ã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æŒã£ãŸJSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ã€‚
â‡’Collectionã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆã™ã‚‹ä¸­ã§ã€å¯¾å¿œã™ã‚‹Resourceã‚¯ãƒ©ã‚¹ã®collection()ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã€‚

â€»ResourceCollectionã‚¯ãƒ©ã‚¹ã§ã€CollectsResourcesã‚¯ãƒ©ã‚¹ã®collectResource()ã‚’å‘¼ã³å‡ºã—ã€
ã€€collects()ã§å¯¾å¿œã™ã‚‹Resourceã‚¯ãƒ©ã‚¹ã‚’å–å¾—ã—ã¦ã„ã‚‹ã€‚
https://github.com/laravel/framework/blob/6.x/src/Illuminate/Http/Resources/Json/ResourceCollection.php

ðŸŸ¢å®šç¾©æ–¹æ³•
ä¾‹ï¼‰
public function toArray($request)
{
    return [
        'data' => $this->collection,ã€€ã€€Resourceã‚¯ãƒ©ã‚¹ã§æ•´å½¢ã—ãŸJSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”¨ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
        'links' => [
            'self' => 'link-value',ã€€ã€€ã€€è¿½åŠ ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
        ],
    ];
}

â‡’JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
    "data": [
        { "id": 1, "name": "Item 1", /* other attributes */ },
        { "id": 2, "name": "Item 2", /* other attributes */ },
        /* ... */
    ],
    "links": {
        "self": "link-value"
    }
}

ã‚¬ã‚¤ãƒ‰ã€Œãƒªã‚½ãƒ¼ã‚¹ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã€

â—ã‚¯ãƒ©ã‚¹åã®å‘½åè¦å‰‡ï¼šResourceã‚¯ãƒ©ã‚¹ã®åå‰ã¨å¯¾å¿œã•ã›ã‚‹ã€‚
ä¾‹ï¼‰UserResourceã‚’å®Ÿè£…ã€€â‡’ã€€UserCollectionã€€ã‚‚ã—ãã¯ã€€UserResourceCollection

â€»Resourceã‚¯ãƒ©ã‚¹ã®åå‰ã‚’ã‚«ã‚¹ã‚¿ãƒžã‚¤ã‚ºã—ãŸã„ã¨ã
public $collects = ã€‡ã€‡::class;

ðŸŸ¢æ•´å½¢ã—ãŸã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹
$this->collection
ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®å„ã‚¢ã‚¤ãƒ†ãƒ ã‚’ã€ãã‚Œãžã‚Œãƒªã‚½ãƒ¼ã‚¹ã‚¯ãƒ©ã‚¹ã«ãƒžãƒƒãƒ”ãƒ³ã‚°ã—ã¦æ•´å½¢ã—ãŸçµæžœãŒä»£å…¥ã•ã‚Œã¦ã„ã‚‹ã€‚

ðŸŸ¢ãƒ‡ãƒ¼ã‚¿ã®ä¸¦ã³é †
ãƒªã‚½ãƒ¼ã‚¹ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€ãƒ¬ã‚³ãƒ¼ãƒ‰ã®idã‚«ãƒ©ãƒ ã‚’æ˜‡é †ã«ã—ã¦ä¸¦ã³æ›¿ãˆã‚‹ã€‚

å…ƒã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®é †ç•ªã®ã¾ã¾ã«ã—ã¦è¿”ã—ãŸã„ã¨ãã¯ã€ä»¥ä¸‹ã®è¨­å®šã‚’ã™ã‚‹ã€‚
public $preserveKeys = true;

ðŸŸ¢JSONãƒ‡ãƒ¼ã‚¿ã®ãƒ©ãƒƒãƒ—
JSONå½¢å¼ã«å¤‰æ›ã•ã‚Œã‚‹ã¨ãã€å¤–å´ã¯dataã‚­ãƒ¼ã§ãƒ©ãƒƒãƒ—ã•ã‚Œã‚‹ã€‚

ãƒ¼ã€€ã‚­ãƒ¼ã‚’ã‚«ã‚¹ã‚¿ãƒžã‚¤ã‚ºã—ãŸã„ã¨ã
public static $wrap = ã‚­ãƒ¼åã®æ–‡å­—åˆ—;

ãƒ¼ã€€ãƒ©ãƒƒãƒ—ã—ãŸããªã„ã¨ã
ã‚¬ã‚¤ãƒ‰ã€Œãƒ‡ãƒ¼ã‚¿ã®ãƒ©ãƒƒãƒ—ã€å¾ŒåŠ

ðŸŸ¢Resourceã‚¯ãƒ©ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ã€ãƒªã‚½ãƒ¼ã‚¹ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’å«ã‚ã‚‹

ä¾‹ï¼‰ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚ãŸã„ã¨ã
class PostResource extends JsonResource
{
    public function toArray($request)
    {
        return [
            'id' => $this->id,
            'title' => $this->title,
            'comments' => new CommentsCollection($this->comments),ã€€ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™ãƒªã‚½ãƒ¼ã‚¹ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
        ];
    }
}

class CommentsCollection extends ResourceCollection
{
    public function toArray($request)
    {
        return ['data' => $this->collection]; â€»ã‚­ãƒ¼ã¯dataã§ãªãã¨ã‚‚OK
    }
}

â‡’Resourceã‚¯ãƒ©ã‚¹ã‚’å‘¼ã³å‡ºã—ãŸã¨ãã®JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
    "id": 1,
    "title": "Example Post",
    "comments": {
        "data": [
            { "id": 1, "text": "First Comment", /* other comment attributes */ },
            { "id": 2, "text": "Second Comment", /* other comment attributes */ },
            /* ... */
        ]
    }
}

ãƒ¼ã€€ã“ã®Resourceã‚¯ãƒ©ã‚¹ã‚’ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«ã—ãŸã„ã¨ã
ã“ã®Resourceã‚¯ãƒ©ã‚¹ã®ãƒªã‚½ãƒ¼ã‚¹ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹ã€‚

ä¾‹ï¼‰PostCollectionã‚’ä½œæˆã™ã‚‹
class PostCollection extends ResourceCollection
{
    public function toArray($request)
    {
        return [
    ã€€ã€€ã€€ã€€ã€€'data' => $this->collection,
            'links' => [
                'self' => 'link-value',ã€€ã€€ã€€è¿½åŠ ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
            ],
ã€€ã€€    ];
    }
}

â‡’ãƒªã‚½ãƒ¼ã‚¹ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‘¼ã³å‡ºã—ãŸã¨ãã®JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
    "data": [
        {
            "id": 1,
            "title": "Example Post 1",
            "comments": {
                "data": [
                    { "id": 1, "text": "First Comment", /* other comment attributes */ },
                    { "id": 2, "text": "Second Comment", /* other comment attributes */ },
                    /* ... */
                ]
            }
        },
        {
            "id": 2,
            "title": "Example Post 2",
            "comments": {
                "data": [
                    { "id": 3, "text": "Third Comment", /* other comment attributes */ },
                    { "id": 4, "text": "Fourth Comment", /* other comment attributes */ },
                    /* ... */
                ]
            }
        },
        /* ... */
    ],
    "links": {
        "self": "link-value"
    }
}

ðŸŸ¢è¦ªã‚¯ãƒ©ã‚¹ã®ãƒªã‚½ãƒ¼ã‚¹ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’åˆ©ç”¨ã™ã‚‹

public function toArray($request)
{
    return parent::toArray($request);ã€€ã€€è¦ªã®å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ©ç”¨ã—ãŸã„
}

ãƒ¼ã€€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹
with()ã§ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã§ãã‚‹ã€‚

public function with($request)
{
    return [
        'meta' => [
            'key' => 'value',
        ],
    ];
}



ðŸŸ¡ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹
ãƒšã‚¸ãƒãƒ¼ã‚¿ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ã€Resourceã‚¯ãƒ©ã‚¹ã®collectionãƒ¡ã‚½ãƒƒãƒ‰ãƒ»ãƒªã‚½ãƒ¼ã‚¹ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«æ¸¡ã™ã“ã¨ãŒã§ãã‚‹ã€‚

ä¾‹ï¼‰return new UserCollection(User::paginate());

â‡’JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
    "data": [
        {
            "id": 1,
            "name": "Eladio Schroeder Sr.",
            "email": "therese28@example.com"
        },
        {
            "id": 2,
            "name": "Liliana Mayert",
            "email": "evandervort@example.com"
        }
    ],
    "links":{
        "first": "http://example.com/pagination?page=1",
        "last": "http://example.com/pagination?page=1",
        "prev": null,
        "next": null
    },
    "meta":{
        "current_page": 1,
        "from": 1,
        "last_page": 1,
        "path": "http://example.com/pagination",
        "per_page": 15,
        "to": 10,
        "total": 10
    }
}

â—linksã‚„metaã‚’toArrayãƒ¡ã‚½ãƒƒãƒ‰å†…ã§å®šç¾©ã—ã¦ã„ãŸå ´åˆã€ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã•ã‚Œã‚‹ã®ã§ã¯ãªãã€
ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã«ãƒžãƒ¼ã‚¸ã•ã‚Œã‚‹ã€‚



â—ãƒªã‚½ãƒ¼ã‚¹ã¯ã„ã‚ã„ã‚ãªAPIã§ä½¿ç”¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€æ¡ä»¶ã‚’ä»˜ã‘ã‚‹ã¨ã€ä¸è¦ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã•ãªã„ã‚ˆã†ã«ã§ãã‚‹ï¼
ðŸŸ¡æ¡ä»¶åˆ†å²

ðŸ”µæ¡ä»¶ã‚’æº€ãŸã™ã¨ãã®ã¿ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å«ã‚ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
when()

ä¾‹ï¼‰'secret' => $this->when($request->user()->isAdmin(), 'secret-value'),

â‡’$request->user()->isAdmin()ãŒtrueã®ã¨ãã¯'secret' => 'secret-value'ã‚’å«ã‚ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ã€‚
ã€€falseã®ã¨ãã¯ã€secretã‚­ãƒ¼è‡ªä½“ãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰å‰Šé™¤ã•ã‚Œã‚‹ã€‚

ãƒ¼ã€€è¿”ã™å€¤ã‚‚å‹•çš„ã«ã—ãŸã„ã¨ã
when()ã®ç¬¬äºŒå¼•æ•°ã¯ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼ã«ã§ãã‚‹ã€‚

ä¾‹ï¼‰
'secret' => $this->when($request->user()->isAdmin(), function () {
    //////è¿”ã‚Šå€¤ã‚’æ±ºã‚ã‚‹å‡¦ç†
    return ã€‡ã€‡;
}),



ðŸ”µ$thisãŒæŒ‡å®šã®å±žæ€§ã‚’æŒã£ã¦ã„ã‚‹ã‹
whenHas()

ä¾‹ï¼‰$thisã«å…¥ã‚‹ãƒ¢ãƒ‡ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ãŒnameå±žæ€§ã‚’æŒã£ã¦ã„ã‚‹ã¨ãã€nameã‚­ãƒ¼ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å«ã‚ã‚‹ã€‚
'name' => $this->whenHas('name')



ðŸ”µ$thisã®æŒ‡å®šã®å±žæ€§ã®å€¤ãŒNULLã§ãªã„ã¨ãã®ã¿
whenNotNull

ä¾‹ï¼‰$thisã«å…¥ã‚‹ãƒ¢ãƒ‡ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã®nameå±žæ€§ã®å€¤ãŒã€NULLã§ã¯ãªã„ã¨ãã€nameã‚­ãƒ¼ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å«ã‚ã‚‹ã€‚
'name' => $this->whenNotNull($this->name),



ðŸ”µè¤‡æ•°æ¡ä»¶ã‚’ã¾ã¨ã‚ã¦æ›¸ã

ãƒ¼ã€€åŒæ¡ä»¶ã§è¤‡æ•°ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å«ã‚ã‚‹

ä¾‹ï¼‰$request->user()->isAdmin()ãŒtrueã®ã¨ãã€ç¬¬äºŒå¼•æ•°ã®ï¼’ã¤ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å«ã¾ã‚Œã‚‹
$this->mergeWhen($request->user()->isAdmin(), [
    'first-secret' => 'value',
    'second-secret' => 'value',
]),

â€»é…åˆ—ãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å«ã¾ã‚Œã‚‹ã‚ã‘ã§ã¯ãªã„

ãƒ¼ã€€ãƒ¬ã‚¹ãƒãƒ³ã‚¹è‡ªä½“ã«æ¡ä»¶ã¥ã‘ã™ã‚‹

ä¾‹ï¼‰$request->user()->isAdmin()ãŒtureã®ã¨ãã€$request->user()->isEditor()ãŒtrueã®ã¨ãã§ã€
ã€€ã€€ãƒªã‚½ãƒ¼ã‚¹ãŒè¿”ã™JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å¤‰ãˆãŸã„ã¨ã

return $this->mergeWhen($request->user()->isAdmin(), [
    'isAdmin' => true,
])->mergeWhen($request->user()->isEditor(), [
    'isEditor' => true,
]);

â€»ifæ–‡ã§ã‚‚æ›¸ãæ›ãˆãŒã§ãã‚‹ãŒã€è¤‡é›‘ã§ãªã„å ´åˆã¯mergeWhenã®æ–¹ãŒè¦‹ã‚„ã™ã„ãŸã‚ã€è¦æ¤œè¨Ž

â—mergeWhenã¯ã€æ–‡å­—åˆ—ã‚­ãƒ¼ã¨æ•°å€¤ã‚­ãƒ¼ãŒæ··åœ¨ã™ã‚‹é…åˆ—å†…ã§ã¯ä½¿ç”¨ã—ãªã„ã€‚
ã¾ãŸã€é †ç•ªã«ä¸¦ã¹ã‚‰ã‚Œã¦ã„ãªã„æ•°å€¤ã‚­ãƒ¼ã‚’æŒã¤é…åˆ—å†…ã§ã¯ä½¿ç”¨ã—ãªã„ã€‚



ðŸ”µãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«é–¢ã™ã‚‹æ¡ä»¶ã¥ã‘

ðŸŸ¢ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã¨ãã®ã¿
whenLoaded()
ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒã™ã§ã«ãƒ¢ãƒ‡ãƒ«ã«ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã¨ãã®ã¿ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å«ã‚ã‚‹ã€‚

ã‚¬ã‚¤ãƒ‰ã€Œæ¡ä»¶ä»˜ããƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€

ðŸŸ¢ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ä»¶æ•°ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã¨ãã®ã¿
whenCounted()
loadCountï¼ˆé–¢é€£ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã®ä»¶æ•°ã‚’ãƒ‡ãƒ¼ã‚¿ã«ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ï¼‰ã§ä»¶æ•°ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã‚‹ã¨ãã®ã¿ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å«ã‚ã‚‹ã€‚

ã‚¬ã‚¤ãƒ‰ã€Œæ¡ä»¶ä»˜ããƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚«ã‚¦ãƒ³ãƒˆã€

ðŸŸ¢ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã¨ãã®ã¿
whenPivotLoaded()
ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã¨ãã®ã¿ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«æŒ‡å®šã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å«ã‚ã‚‹ã€‚

ã‚¬ã‚¤ãƒ‰ã€Œæ¡ä»¶ä»˜ããƒ”ãƒœãƒƒãƒˆæƒ…å ±ã€



ðŸŸ¡ãƒªã‚½ãƒ¼ã‚¹ã‚„ãƒªã‚½ãƒ¼ã‚¹ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹è‡ªä½“ã‚’æ•´å½¢ã™ã‚‹

ãƒ¼ã€€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ 
additional()
ãƒªã‚½ãƒ¼ã‚¹ã‚„ãƒªã‚½ãƒ¼ã‚¹ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‘¼ã³å‡ºã—ãŸã‚ã¨ã‹ã‚‰ã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹ã€‚

ä¾‹ï¼‰
return (new UserCollection(User::all()->load('roles')))
                ->additional(['meta' => [
                    'key' => 'value',
                ]]);



ðŸŸ¡HTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ã‚«ã‚¹ã‚¿ãƒžã‚¤ã‚ºã™ã‚‹ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã®è¿½åŠ ãªã©ï¼‰
ãƒªã‚½ãƒ¼ã‚¹ã‚„ãƒªã‚½ãƒ¼ã‚¹ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ã„ã‚‹ã¨ãã«ã€HTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ã‚«ã‚¹ã‚¿ãƒžã‚¤ã‚ºã—ãŸã„ã¨ã

ãƒ»ãƒ˜ãƒƒãƒ€ãƒ¼è¿½åŠ 
ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´
ãƒ»ã‚¯ãƒƒã‚­ãƒ¼ã®è¿½åŠ 
ãªã©

â‘ response()ã‚’ãƒã‚§ãƒ¼ãƒ³ã™ã‚‹
â‘¡Resourceã‚¯ãƒ©ã‚¹ã§ã€withResponseãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã™ã‚‹

ðŸ”µresponse()ã‚’ãƒã‚§ãƒ¼ãƒ³ã™ã‚‹
ä¾‹ï¼‰
return (new UserResource(User::find(1)))
            ->response()
            ->header('X-Value', 'True');



ðŸ”µResourceã‚¯ãƒ©ã‚¹ã§ã€withResponseãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã™ã‚‹
ä¾‹ï¼‰
public function withResponse($request, $response)
{
    $response->header('X-Value', 'True');
}
